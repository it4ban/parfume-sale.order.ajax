// @ts-nocheck
function handleCalendarButton(e,t){e.preventDefault(),e.stopPropagation();const o=e.currentTarget;t.classList.contains("is-open")?(t.classList.remove("is-open"),o.classList.remove("is-active")):(t.classList.add("is-open"),o.classList.add("is-active"))}function calcDiffDays(e){const t=document.querySelector(".order__accordion-form-day-label strong");if(!t)return void console.error("firstDate is not found");const o=parseInt(t.textContent.trim(),10),n=e.getDate();return console.log("Текущий день:",o),console.log("Выбранный день:",n),n-o}async function handleSelectDataClick(e,t){t&&"BUTTON"===t.tagName&&(t.type="button");const o=calcDiffDays(e),n=e.getDate();if(o>=6||o<0)try{const t=document.querySelector(".order__accordion-form-day"),o=new Date(e).toISOString().split("T")[0],n=await fetch(`/ajax/get_delivery_days.php?date=${o}`);if(!n.ok){const e=await n.json();throw new Error(e.error||"Error receiving data")}const a=await n.text();if(t){t.querySelectorAll(".order__accordion-form-day-label").forEach((e=>e.remove())),t.insertAdjacentHTML("afterbegin",a),handleInitTiles(this),handleInitInputPoints()}else console.error("tileDays not found")}catch(e){console.error("Error receiving data:",e)}setActiveTile(n),setOrderDate(e),toggleTimeBlocksByDay(e)}function setOrderDate(e){const t=document.getElementById("ms_date_putn");if(t){const o=e.toLocaleDateString("ru-RU");t.value=o,t.dataset.date=o}else console.error("DateInput is not found")}function setActiveTile(e){const t=document.querySelectorAll(".order__accordion-form-day-label");t?t.forEach((t=>{const o=t.querySelector("strong");if(!o)return;parseInt(o.textContent.trim(),10)===e?t.classList.add("is-active"):t.classList.remove("is-active")})):console.error("dayLabels is not found")}function handleTileClick(e){const t=this.getSelectedDate();if(!t)return void console.error("Failed to get current calendar date");const o=e.querySelector("strong"),n=parseInt(o.textContent.trim(),10);if(isNaN(n))return void console.error("Incorrect day value:",o?.textContent);const a=new Date(t);a.setDate(n),this.setSelectedDate(a),setOrderDate(a),toggleTimeBlocksByDay(a)}function initEventsDate(){const e=new Date;e.setHours(0,0,0,0);const t=new Date(e);return t.setFullYear(e.getFullYear()-1),[{start:t.toISOString().split("T")[0],end:e.toISOString().split("T")[0],color:"#1E292F"}]}function handleTimeClick(e){const t=e.querySelector("p");if(!t)return void console.error("Time label <p> not found");const o=t.textContent.trim(),[n,a]=o.split("-").map((e=>e.trim()));if(!n||!a)return void console.error("Incorrect time format:",o);const r=document.getElementById("ms_time_min"),s=document.getElementById("ms_time_max");r&&(r.value=n),s&&(s.value=a)}function handleDisableBlock(e){e.querySelectorAll(".order__accordion-form-time-label").forEach((e=>{e.classList.add("disabled"),e.setAttribute("disabled","disabled")})),e.classList.add("is-disabled")}function handleEnableBlock(e){e.querySelectorAll(".order__accordion-form-time-label").forEach((e=>{e.classList.remove("disabled"),e.removeAttribute("disabled")})),e.classList.remove("is-disabled")}function toggleTimeBlocksByDay(e){const t=e.getDay(),o=document.querySelector(".order__accordion-form-time--weak"),n=document.querySelector(".order__accordion-form-time--weakend");if(!o||!n)return;let a;0===t||6===t?(handleDisableBlock(o),handleEnableBlock(n),a=n):(handleEnableBlock(o),handleDisableBlock(n),a=o);const r=new Date;if(e.toDateString()===r.toDateString()){const e=60*r.getHours()+r.getMinutes();a.querySelectorAll(".order__accordion-form-time-label").forEach((t=>{const o=t.textContent.trim(),[n,a]=o.split("-").map((e=>e.trim()));if(!n||!a)return;const[r,s]=a.split(":").map(Number);e>=60*r+s?(t.classList.add("disabled"),t.setAttribute("disabled","disabled")):(t.classList.remove("disabled"),t.removeAttribute("disabled"))}))}}function handleInitCalendar(){try{const e=document.querySelector(".order__accordion-form-day-button"),t=document.getElementById("calendar"),o=initEventsDate(),n=new Calendar({container:()=>t,calendarSize:"small",dropShadow:"",border:"1px solid #000",customWeekdayValues:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],customMonthValues:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],fontFamilyHeader:"Evolventa",fontFamilyWeekdays:"Evolventa",fontFamilyBody:"Evolventa",eventsData:o,onSelectedDateClick:(e,t)=>handleSelectDataClick.call(n,e,t),onMonthChange:()=>{t.querySelectorAll("button").forEach((e=>e.type="button"))}});return e.addEventListener("click",(e=>handleCalendarButton(e,t))),n}catch(e){throw new Error(e)}}function handleInitTiles(e){e||console.error("calendarInstance is not defined");document.querySelectorAll(".order__accordion-form-day-label").forEach((t=>{t.addEventListener("click",(()=>handleTileClick.call(e,t)))}))}function handleInitTimeTiles(e){document.querySelectorAll(".order__accordion-form-time-label").forEach((e=>{e.addEventListener("click",(()=>handleTimeClick(e)))}))}function handleInitAddressSuggestions(){[{id:"soa-property-38",type:"address",full:!0,ulClass:"suggestions-list"},{id:"soa-property-115",type:"address",full:!1,ulClass:"suggestions-list"}].forEach((e=>{const t=document.getElementById(e.id);if(!t)return;let o=t.parentNode.querySelector(`.${e.ulClass}`);o||(o=document.createElement("ul"),o.className=e.ulClass,t.parentNode.appendChild(o)),t.addEventListener("input",(async()=>{const n=t.value.trim();if(!n)return o.innerHTML="",void(o.style.display="none");let a=n;if("street"===e.id){const e=document.getElementById("soa-property-38"),t=e?e.value.trim():"";t&&(a=`${t}, ${n}`)}try{const t=await fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Token 72a2cc8f7ce97a6d1acbf5c572a5bfd49d857e07"},body:JSON.stringify({query:a,count:5})}),n=await t.json();o.innerHTML="",n.suggestions.forEach((t=>{let n;if(e.full)n=t.value;else{n=`${t.data.city_with_type||t.data.settlement_with_type||""} ${t.data.street_with_type||""}${t.data.house?`, ${t.data.house}`:""}`.trim()}const a=document.createElement("li");a.textContent=n,a.dataset.suggestion=JSON.stringify(t),o.appendChild(a)})),o.style.display=n.suggestions.length?"block":"none"}catch(e){console.error(e)}})),o.addEventListener("click",(e=>{if("LI"!==e.target.tagName)return;const t=JSON.parse(e.target.dataset.suggestion),n=document.getElementById("soa-property-38"),a=document.getElementById("soa-property-115"),r=document.getElementById("soa-property-118");if(n&&(n.value=t.value||""),a){const e=`${t.data.street_with_type||""} ${t.data.house||""}`.trim();a.value=e}r&&(r.value=t.data.flat||""),o.innerHTML="",o.style.display="none"})),document.addEventListener("click",(e=>{t.contains(e.target)||o.contains(e.target)||(o.innerHTML="",o.style.display="none")}))}))}function handleInitInputPoints(){const e=document.querySelectorAll("input"),t=document.querySelectorAll("textarea");if(e&&(e.forEach((e=>{e.onfocus=()=>{e.parentElement.classList.add("is-focus")},e.onblur=()=>{e.parentElement.classList.remove("is-focus")}})),t)){if(t.forEach((e=>{e.onfocus=()=>{e.parentElement.classList.add("is-focus")},e.onblur=()=>{setTimeout((()=>{e.parentElement.classList.remove("is-focus")}),2e3)}})),document.querySelector(".order__accordion-delivery-label")){const e=document.querySelectorAll(".order__accordion-delivery-label");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("is-active")})),t.classList.add("is-active")}))}))}if(document.querySelector(".order__accordion-form-day-label")){const e=document.querySelectorAll(".order__accordion-form-day-label");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("is-active")})),t.classList.add("is-active")}))}))}if(document.querySelector(".order__accordion-form-time-label")){const e=document.querySelectorAll(".order__accordion-form-time-label");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("is-active")})),t.classList.add("is-active")}))}))}if(document.querySelector(".order__pay-slide")){const e=document.querySelectorAll(".order__pay-slide");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("is-active")})),t.classList.add("is-active")}))}))}}}function handleInit(){const e=handleInitCalendar();handleInitInputPoints(),handleInitTiles(e),handleInitTimeTiles(e),handleInitAddressSuggestions()}document.addEventListener("DOMContentLoaded",(()=>{handleInit()})),BX.addCustomEvent("onAjaxSuccess",(()=>{handleInit()}));