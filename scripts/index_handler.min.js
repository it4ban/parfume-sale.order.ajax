// @ts-nocheck
function handleCalendarButton(e,t){e.preventDefault(),e.stopPropagation();const o=e.currentTarget;t.classList.contains("is-open")?(t.classList.remove("is-open"),o.classList.remove("is-active")):(t.classList.add("is-open"),o.classList.add("is-active"))}function calcDiffDays(e){const t=document.querySelector(".order__accordion-form-day-label strong");if(!t)return void console.error("firstDate is not found");const o=parseInt(t.textContent.trim(),10),n=e.getDate();return console.log("Текущий день:",o),console.log("Выбранный день:",n),n-o}async function handleSelectDataClick(e,t){t&&"BUTTON"===t.tagName&&(t.type="button");const o=calcDiffDays(e),n=e.getDate();if(o>=6||o<0)try{const t=document.querySelector(".order__accordion-form-day"),o=new Date(e).toISOString().split("T")[0],n=await fetch(`/ajax/get_delivery_days.php?date=${o}`);if(!n.ok){const e=await n.json();throw new Error(e.error||"Error receiving data")}const r=await n.text();if(t){t.querySelectorAll(".order__accordion-form-day-label").forEach((e=>e.remove())),t.insertAdjacentHTML("afterbegin",r),handleInitTiles(this),handleInitInputPoints()}else console.error("tileDays not found")}catch(e){console.error("Error receiving data:",e)}setActiveTile(n),setOrderDate(e),toggleTimeBlocksByDay(e)}function setOrderDate(e){const t=document.getElementById("ms_date_putn");if(t){const o=e.toLocaleDateString("ru-RU");t.value=o,t.dataset.date=o}else console.error("DateInput is not found")}function setActiveTile(e){const t=document.querySelectorAll(".order__accordion-form-day-label");t?t.forEach((t=>{const o=t.querySelector("strong");if(!o)return;parseInt(o.textContent.trim(),10)===e?t.classList.add("is-active"):t.classList.remove("is-active")})):console.error("dayLabels is not found")}function handleTileClick(e){const t=this.getSelectedDate();if(!t)return void console.error("Failed to get current calendar date");const o=e.querySelector("strong"),n=parseInt(o.textContent.trim(),10);if(isNaN(n))return void console.error("Incorrect day value:",o?.textContent);const r=new Date(t);r.setDate(n),this.setSelectedDate(r),setOrderDate(r),toggleTimeBlocksByDay(r)}function initEventsDate(){const e=new Date;e.setHours(0,0,0,0);const t=new Date(e);return t.setFullYear(e.getFullYear()-1),[{start:t.toISOString().split("T")[0],end:e.toISOString().split("T")[0],color:"#1E292F"}]}function handleTimeClick(e){const t=e.querySelector("p");if(!t)return void console.error("Time label <p> not found");const o=t.textContent.trim(),[n,r]=o.split("-").map((e=>e.trim()));if(!n||!r)return void console.error("Incorrect time format:",o);const a=document.getElementById("ms_time_min"),c=document.getElementById("ms_time_max");a&&(a.value=n),c&&(c.value=r)}function handleDisableBlock(e){e.querySelectorAll(".order__accordion-form-time-label").forEach((e=>{e.classList.add("disabled"),e.setAttribute("disabled","disabled")})),e.classList.add("is-disabled")}function handleEnableBlock(e){e.querySelectorAll(".order__accordion-form-time-label").forEach((e=>{e.classList.remove("disabled"),e.removeAttribute("disabled")})),e.classList.remove("is-disabled")}function toggleTimeBlocksByDay(e){const t=e.getDay(),o=document.querySelector(".order__accordion-form-time--weak"),n=document.querySelector(".order__accordion-form-time--weakend");if(!o||!n)return;let r;0===t||6===t?(handleDisableBlock(o),handleEnableBlock(n),r=n):(handleEnableBlock(o),handleDisableBlock(n),r=o);const a=new Date;if(e.toDateString()===a.toDateString()){const e=60*a.getHours()+a.getMinutes();r.querySelectorAll(".order__accordion-form-time-label").forEach((t=>{const o=t.textContent.trim(),[n,r]=o.split("-").map((e=>e.trim()));if(!n||!r)return;const[a,c]=r.split(":").map(Number);e>=60*a+c?(t.classList.add("disabled"),t.setAttribute("disabled","disabled")):(t.classList.remove("disabled"),t.removeAttribute("disabled"))}))}}function handleInitCalendar(){try{const e=document.getElementById("calendar");if(!e)return;const t=initEventsDate(),o=new Calendar({container:()=>e,calendarSize:"small",dropShadow:"",border:"1px solid #000",customWeekdayValues:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],customMonthValues:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],fontFamilyHeader:"Evolventa",fontFamilyWeekdays:"Evolventa",fontFamilyBody:"Evolventa",eventsData:t,onSelectedDateClick:(e,t)=>handleSelectDataClick.call(o,e,t),onMonthChange:()=>{e.querySelectorAll("button").forEach((e=>e.type="button"))}});return o}catch(e){throw new Error(e)}}function handleInitTiles(e){e||console.error("calendarInstance is not defined");document.querySelectorAll(".order__accordion-form-day-label").forEach((t=>{t.addEventListener("click",(()=>handleTileClick.call(e,t)))}))}function handleInitTimeTiles(e){document.querySelectorAll(".order__accordion-form-time-label").forEach((e=>{e.addEventListener("click",(()=>handleTimeClick(e)))}))}function handleInitInputPoints(){const e=document.querySelectorAll("input"),t=document.querySelectorAll("textarea");if(e&&(e.forEach((e=>{e.onfocus=()=>{e.parentElement.classList.add("is-focus")},e.onblur=()=>{e.parentElement.classList.remove("is-focus")}})),t)){if(t.forEach((e=>{e.onfocus=()=>{e.parentElement.classList.add("is-focus")},e.onblur=()=>{setTimeout((()=>{e.parentElement.classList.remove("is-focus")}),2e3)}})),document.querySelector(".order__accordion-delivery-label")){const e=document.querySelectorAll(".order__accordion-delivery-label");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("is-active")})),t.classList.add("is-active")}))}))}if(document.querySelector(".order__accordion-form-day-label")){const e=document.querySelectorAll(".order__accordion-form-day-label");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("is-active")})),t.classList.add("is-active")}))}))}if(document.querySelector(".order__accordion-form-time-label")){const e=document.querySelectorAll(".order__accordion-form-time-label");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("is-active")})),t.classList.add("is-active")}))}))}if(document.querySelector(".order__pay-slide")){const e=document.querySelectorAll(".order__pay-slide");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>{e.classList.remove("is-active")})),t.classList.add("is-active")}))}))}}}function handleInit(){const e=handleInitCalendar();e&&(handleInitInputPoints(),handleInitTiles(e),handleInitTimeTiles(e))}document.addEventListener("DOMContentLoaded",(()=>{handleInit()})),document.addEventListener("click",(e=>{if(!e.target.closest(".order__accordion-form-day-button"))return;const t=document.getElementById("calendar");t&&handleCalendarButton(e,t)})),BX.addCustomEvent("onAjaxSuccess",(()=>{handleInit()}));